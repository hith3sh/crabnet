# Memory 2026-01-28 - Issue #295: Finlex Implementation

---

## Tasks Completed

- [x] Issue #235 (HTML Blob QC) - Complete âœ…
- [x] Issue #294 (Newsfeed v2) - Complete âœ…
- [x] Issue #295 (Finlex) - Started âœ…
- [ ] Issue #296 (KILA) - Not started
- [ ] Issue #297 (TELP) - Not started
- [ ] Issue #298 (Kela) - Not started

---

## Current Branch

**Branch Created:** `feat/295-finlex-implementation` (from Issue #295)
**Parent Branch:** `feat/294-newsfeed-v2-content-hash` (Issue #294)
**Based On:** Issue #294 Newsfeed v2 implementation

---

## Issue #295: Finlex Implementation

**Objective:** Add Finlex table as a Finnish source to Newsfeed v2 with content change detection

**Components:**
- Database migration (content_hash column) - Already exists from Issue #294
- Model updates (NewsfeedItem with content_hash) - Already exists from Issue #294
- ETL processor (NewsfeedPopulatorETL) - Already exists from Issue #294
- CLI integration (newsfeed_populator command) - Already exists from Issue #294
- Configuration (SOURCE_COUNTRY_MAP) - Already exists from Issue #294

**What's Unique for Finlex:**
- **Query approach** - Finlex uses `as_of` window filtering instead of `published_at` to catch content changes
- **Static `published_at`** - Documents keep original date even when content changes
- **Finnish sources** - Finlex is part of Finnish legislation database (laws, government proposals, court cases)
- **Multi-language** - Supports English, Finnish, Swedish

---

## Implementation Plan

### 1. Database Schema Verification
- [x] Verify `finlex` table has required columns: `content_hash`, `as_of`, `url`, `published_at`
- [x] Verify `newsfeed_items` table can store content_hash and supports Finlex entries
- [x] Verify SOURCE_COUNTRY_MAP includes `"finlex": "fi"`

### 2. SQL Query Update
- [ ] Modify NewsfeedPopulatorETL.get_records() to query `finlex` table
- [ ] Add `as_of >= CURRENT_DATE - INTERVAL '7 days'` filter
- [ ] Add `content_hash` to SELECT clause
- [ ] Add NOT EXISTS subquery for deduplication: `AND ni.content_hash = finlex.content_hash`
- [ ] Remove `published_at` filter from WHERE clause (Finlex uses static dates)

### 3. Testing
- [ ] Run `bin/etl_runner.py newsfeed_populator finlex --dry-run`
- [ ] Verify candidate documents are queried correctly
- [ ] Check dry-run output for proper SQL generation

### 4. Validation
- [ ] Verify LLM enrichment produces summaries in all 3 languages (en, fi, sv)
- [ ] Verify accounting category classification works for legislative content
- [ ] Verify relevancy scoring is appropriate (0.5-0.9 range)

### 5. Deployment
- [ ] Run `bin/etl_runner.py newsfeed_populator finlex` (production run)
- [ ] Verify newsfeed_items are created correctly
- [ ] Verify content_hash values are stored properly
- [ ] Check for duplicates (should not exist due to NOT EXISTS check)

---

## Sub-Issues

- [ ] Issue #296 (KILA) - Accounting board
- [ ] Issue #297 (TELP) - Employment/labor guidance
- [ ] Issue #298 (Kela) - Social insurance

---

## Notes

- Issue #295 is a **sub-issue** of Issue #294 (Newsfeed v2)
- All database infrastructure (migrations, models) is already complete from Issue #294
- ETL processor, CLI, and configuration are already complete from Issue #294
- This is **feature implementation** built on top of existing infrastructure
- No new database migrations needed (content_hash column already exists)

**Why separate sub-issue?**
- Finlex is a significant, high-impact source requiring dedicated testing
- Allows for focused PR and code review per source
- Enables granular deployment (test Finlex, then KILA, then TELP, etc.)

---

## ðŸš€ Current Branch

`feat/295-finlex-implementation`

Based on: Issue #294 (Newsfeed v2) - All infrastructure complete

Ready to implement Finlex-specific code!
